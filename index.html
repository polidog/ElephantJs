<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Elephantjs : ElephantJs is a library for running javascript from php" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Elephantjs</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/polidog/ElephantJs">View on GitHub</a>

          <h1 id="project_title">Elephantjs</h1>
          <h2 id="project_tagline">ElephantJs is a library for running javascript from php</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/polidog/ElephantJs/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/polidog/ElephantJs/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>ElephantJs</h1>

<p><img src="http://www.polidog.jp/images/zou.gif" alt="zou"></p>

<p>ElephantJsは、PHPからJavascritpを実行するためのライブラリです。<br>
使用するためにはV8Jsが必要です。
それから、もちろんV8エンジンも必要なわけです。   </p>

<p>Macで使う場合</p>

<pre><code>brew install v8
pecl install v8js-0.1.3
</code></pre>

<h3>使い方</h3>

<hr><pre><code>require 'ElephantJs.php';

$a = "ElephantJs samples string a";

// 普通に動かす
$jsElephant = new ElephantJs(get_defined_vars());
$jsElephant-&gt;execute('print(PHP.getVars("a","local") + "\n");');
</code></pre>

<p>これで実行すれば、以下のように出力されます  </p>

<pre><code>ElephantJs samples string a
</code></pre>

<p>ファイルから実行したい場合は</p>

<pre><code>require 'ElephantJs.php';
$jsElephant = new ElephantJs(get_defined_vars());
$jsElephant-&gt;executeFile('sample.js');
</code></pre>

<p>とファイル名を指定すれば実行できます。<br>
実行したいディレクトリが別の場所の場合は指定することもできます。  </p>

<pre><code>require 'ElephantJs.php';
$jsElephant = new ElephantJs(get_defined_vars());
$jsElephant-&gt;executeFile('sample.js','/var/www/html/js');
</code></pre>

<p><em>注意</em> コンストラクタで必ずget_defined_vars()を引数として実行しないとローカルスコープの変数が取得できません。</p>

<h4>Javascriptオブジェクトについて</h4>

<hr><p>ElephantJsで実行した場合にPHPという変数名でJavascript側にオブジェクトが渡されます。<br>
今のところメソッドは以下のものを用意しています。</p>

<pre><code>PHP.getVars('変数名','local'); // 第二引数はlocal or globalを指定する
</code></pre>

<p>PHP.getVars()を実行することによりPHP側の変数を取得する事ができます。 
あと実行しているPHPのバージョンを取得したい場合は、PHP.versionで取得できます。</p>

<p>ちなみに、メソッドが足りない場合にPHP側からメソッドを動的に増やす事も出来ます。</p>

<p>例:printlnを追加する  </p>

<pre><code>$jsElephant-&gt;attachJs(array(
    'println' =&gt; 'function(key) { print( key + "\n") };'
));
$jsElephant-&gt;execute('PHP.println("これはJavascriptです。うそではないです。");');
</code></pre>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Elephantjs maintained by <a href="https://github.com/polidog">polidog</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-35796846-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
